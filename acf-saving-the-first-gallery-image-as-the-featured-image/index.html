<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ACF &#8211; Saving the first gallery image as the featured image &#8211; Matt Radford</title>
<link rel="canonical" href="/acf-saving-the-first-gallery-image-as-the-featured-image/">
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2Facf-saving-the-first-gallery-image-as-the-featured-image%2F">
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2Facf-saving-the-first-gallery-image-as-the-featured-image%2F&#038;format=xml">
    <style>body img {max-width: 100%;height: auto;}</style>
            <!-- All Glory to the Hypno Toad! -->
    </head>

    <body>
        
        <header>
            <a href="/">Matt Radford</a>
            <p>Messing with links since &lt;blink&gt;</p>
            <nav>
                <ul id="menu-primary-navigation" class="menu">
<li id="menu-item-961" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-961"><a href="/about/">About</a></li>
</ul>            </nav>
        </header>

        <main>            <article id="post-328" class="post-328 post type-post status-publish format-standard hentry">
            <header>
                <h1>ACF &#8211; Saving the first gallery image as the featured image</h1>
                <span>Published on&nbsp;</span><time datetime="2015-08-27T21:33:29+00:00">2015-08-27</time>            </header>
            <section>
                
<p>I decided to use the Advanced Custom Fields Gallery field to show some images on a specific post type. Easy enough, but I wanted to set the featured image from the first gallery image, as there&#8217;s a performance hit involved in retrieving all those gallery arrays on, say an archive or search results page.&nbsp;A quick Googling and I found some code that almost did it:</p>



<p><a href="http://support.advancedcustomfields.com/forums/topic/display-1-gallery-picture-on-archive-page/">http://support.advancedcustomfields.com/forums/topic/display-1-gallery-picture-on-archive-page/</a></p>



<p>The answer from&nbsp;marius.stuparu <em>almost</em> did do the job, namely:</p>


<div id="gist25825350" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-gallery_post_thumbnail-php" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-php  ">

        
<div class="js-check-bidi js-blob-code-container blob-code-content">

  <template class="js-file-alert-template">
  <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center">
  <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
  
    <span>
      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span>


  <div data-view-component="true" class="flash-action">      <a href="/acf-saving-the-first-gallery-image-as-the-featured-image/%7B%7B%20revealButtonHref%20%7D%7D" data-view-component="true" class="btn-sm btn">  Show hidden characters
  
</a>
</div>
</div></template>
<template class="js-line-alert-template">
  <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e">
    <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
</span></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip data-tagsearch-lang="PHP" data-tagsearch-path="gallery_post_thumbnail.php">
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L1" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-gallery_post_thumbnail-php-LC1" class="blob-code blob-code-inner js-file-line">function set_featured_image_from_gallery() {</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L2" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-gallery_post_thumbnail-php-LC2" class="blob-code blob-code-inner js-file-line">  $has_thumbnail = get_the_post_thumbnail($post-<span class="pl-kos">&gt;</span>ID);</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L3" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-gallery_post_thumbnail-php-LC3" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L4" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-gallery_post_thumbnail-php-LC4" class="blob-code blob-code-inner js-file-line">  if ( !$has_thumbnail ) {</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L5" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-gallery_post_thumbnail-php-LC5" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L6" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-gallery_post_thumbnail-php-LC6" class="blob-code blob-code-inner js-file-line">    $images = get_field('gallery', false, false);</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L7" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-gallery_post_thumbnail-php-LC7" class="blob-code blob-code-inner js-file-line">    $image_id = $images[0];</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L8" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="8"></td>
          <td id="file-gallery_post_thumbnail-php-LC8" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L9" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="9"></td>
          <td id="file-gallery_post_thumbnail-php-LC9" class="blob-code blob-code-inner js-file-line">    if ( $image_id ) {</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L10" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="10"></td>
          <td id="file-gallery_post_thumbnail-php-LC10" class="blob-code blob-code-inner js-file-line">      set_post_thumbnail( $post-<span class="pl-kos">&gt;</span>ID, $image_id );</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L11" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="11"></td>
          <td id="file-gallery_post_thumbnail-php-LC11" class="blob-code blob-code-inner js-file-line">    }</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L12" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="12"></td>
          <td id="file-gallery_post_thumbnail-php-LC12" class="blob-code blob-code-inner js-file-line">  }</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L13" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="13"></td>
          <td id="file-gallery_post_thumbnail-php-LC13" class="blob-code blob-code-inner js-file-line">}</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L14" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="14"></td>
          <td id="file-gallery_post_thumbnail-php-LC14" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-gallery_post_thumbnail-php-L15" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="15"></td>
          <td id="file-gallery_post_thumbnail-php-LC15" class="blob-code blob-code-inner js-file-line">add_action( 'save_post', 'set_featured_image_from_gallery' );</td>
        </tr>
  </table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/mattradford/5d097d41e326ffeeee33/raw/b4aea7b94e35adcfcdcef77c0bebb3ac475fce67/gallery_post_thumbnail.php" style="float:right">view raw</a>
        <a href="https://gist.github.com/mattradford/5d097d41e326ffeeee33#file-gallery_post_thumbnail-php">
          gallery_post_thumbnail.php
        </a>
        hosted with &#10084; by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>




<p>However, I noticed straight away a couple of problems. I&#8217;m using this in a functions.php file, i.e. outside the loop, so <code>global $post</code> was required, plus some changes to <code>get_field</code>.</p>



<p>But more than that, the code was giving a load of <code>trying to get property of non-object</code> errors when saving other post objects in the backend, such as menus. The solution was changing the hook from <code>save_post</code> to <code>save_post_{$post-type}</code>, which is documented in the <a href="https://codex.wordpress.org/Plugin_API/Action_Reference/save_post">Codex entry</a> for <code>save_post</code>; its been there <a href="http://adambrown.info/p/wp_hooks/hook/save_post_%7B$post-%3Epost_type%7D">since 3.7</a>.</p>



<p>So the solution then, which doesn&#8217;t give any errors, is below.</p>


<div id="gist25828382" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-featured-image-from-gallery-php" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-php  ">

        
<div class="js-check-bidi js-blob-code-container blob-code-content">

  <template class="js-file-alert-template">
  <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center">
  <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
  
    <span>
      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span>


  <div data-view-component="true" class="flash-action">      <a href="/acf-saving-the-first-gallery-image-as-the-featured-image/%7B%7B%20revealButtonHref%20%7D%7D" data-view-component="true" class="btn-sm btn">  Show hidden characters
  
</a>
</div>
</div></template>
<template class="js-line-alert-template">
  <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e">
    <svg aria-hidden="true" height="16" viewbox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
</span></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip data-tagsearch-lang="PHP" data-tagsearch-path="featured image from gallery.php">
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L1" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-featured-image-from-gallery-php-LC1" class="blob-code blob-code-inner js-file-line">function set_featured_image_from_gallery() {</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L2" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-featured-image-from-gallery-php-LC2" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L3" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-featured-image-from-gallery-php-LC3" class="blob-code blob-code-inner js-file-line">    global $post;</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L4" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-featured-image-from-gallery-php-LC4" class="blob-code blob-code-inner js-file-line">    $post_id = $post-<span class="pl-kos">&gt;</span>ID;</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L5" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-featured-image-from-gallery-php-LC5" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L6" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-featured-image-from-gallery-php-LC6" class="blob-code blob-code-inner js-file-line">    $has_thumbnail = get_the_post_thumbnail($post_id);</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L7" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-featured-image-from-gallery-php-LC7" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L8" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="8"></td>
          <td id="file-featured-image-from-gallery-php-LC8" class="blob-code blob-code-inner js-file-line">      if ( !$has_thumbnail ) {</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L9" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="9"></td>
          <td id="file-featured-image-from-gallery-php-LC9" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L10" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="10"></td>
          <td id="file-featured-image-from-gallery-php-LC10" class="blob-code blob-code-inner js-file-line">        $images = get_field('image_gallery', $post_id, false);</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L11" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="11"></td>
          <td id="file-featured-image-from-gallery-php-LC11" class="blob-code blob-code-inner js-file-line">        $image_id = $images[0];</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L12" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="12"></td>
          <td id="file-featured-image-from-gallery-php-LC12" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L13" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="13"></td>
          <td id="file-featured-image-from-gallery-php-LC13" class="blob-code blob-code-inner js-file-line">        if ( $image_id ) {</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L14" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="14"></td>
          <td id="file-featured-image-from-gallery-php-LC14" class="blob-code blob-code-inner js-file-line">          set_post_thumbnail( $post_id, $image_id );</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L15" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="15"></td>
          <td id="file-featured-image-from-gallery-php-LC15" class="blob-code blob-code-inner js-file-line">        }</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L16" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="16"></td>
          <td id="file-featured-image-from-gallery-php-LC16" class="blob-code blob-code-inner js-file-line">      }</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L17" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="17"></td>
          <td id="file-featured-image-from-gallery-php-LC17" class="blob-code blob-code-inner js-file-line">
</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L18" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="18"></td>
          <td id="file-featured-image-from-gallery-php-LC18" class="blob-code blob-code-inner js-file-line">}</td>
        </tr>
        <tr class="line">
          <td id="file-featured-image-from-gallery-php-L19" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="19"></td>
          <td id="file-featured-image-from-gallery-php-LC19" class="blob-code blob-code-inner js-file-line">add_action( 'save_post_property', 'set_featured_image_from_gallery' );</td>
        </tr>
  </table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/mattradford/b4db20572c11780d3138/raw/466678c52e8e1a6564cde71e868305a6cbfdda51/featured%20image%20from%20gallery.php" style="float:right">view raw</a>
        <a href="https://gist.github.com/mattradford/b4db20572c11780d3138#file-featured-image-from-gallery-php">
          featured image from gallery.php
        </a>
        hosted with &#10084; by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>

            </section>
        </article>
        </main>

    <footer>
        <p><small>&copy; 1996 - 2022 Matt Radford. As ever, built with <a href="http://wordpress.org/">WordPress</a>.</small></p>
    </footer>
    <link rel="stylesheet" id="gistpress-css" href="https://github.githubassets.com/assets/gist-embed-39872b2714d6.css?ver=6.0" type="text/css" media="all">

</body>
</html>